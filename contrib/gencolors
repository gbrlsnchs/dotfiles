#!/bin/sh

background="efefef"
foreground="1f1f1f"
color0="3f3f3f"
color1="7f0000"
color2="007f00"
color3="7f7f00"
color4="00007f"
color5="7f007f"
color6="007f7f"
color7="7f7f7f"
color8="3f3f3f"
color9="7f0000"
color10="007f00"
color11="7f7f00"
color12="00007f"
color13="7f007f"
color14="007f7f"
color15="dfdfdf"

MONITOR1="${MONITOR1:-DP-1}"
MONITOR1_W="${MONITOR1_RES:-2560}"
MONITOR1_H="${MONITOR1_RES:-1080}"
MONITOR1_POS="${MONITOR1_RES:-0,0}"
MONITOR2="${MONITOR2:-HDMI-A-1}"
MONITOR2_W="${MONITOR1:-1920}"
MONITOR2_H="${MONITOR1:-1080}"
MONITOR2_POS="${MONITOR2:-320,1080}"

CURSOR_THEME="${CURSOR_THEME:-Neutral_Plus}"
WALLPAPER="$(xdg-user-dir PICTURES)/wallpaper.png"

# Clean directories first.
for dir in templates/* ; do
	for template in $dir/* ; do
		outdir="$(dirname "$template")"

		outdir="$XDG_CACHE_HOME/dotfiles/$outdir"
		mkdir --parents "$outdir" || continue

		file="$outdir/$(basename "$template")"

		sed --expression "s/{{notice}}/This file was generated by a script, don't touch it!/g" \
			--expression "s/{{background}}/$background/g" \
			--expression "s/{{foreground}}/$foreground/g" \
			--expression "s/{{color0}}/$color0/g" \
			--expression "s/{{color1}}/$color1/g" \
			--expression "s/{{color2}}/$color2/g" \
			--expression "s/{{color3}}/$color3/g" \
			--expression "s/{{color4}}/$color4/g" \
			--expression "s/{{color5}}/$color5/g" \
			--expression "s/{{color6}}/$color6/g" \
			--expression "s/{{color7}}/$color7/g" \
			--expression "s/{{color8}}/$color8/g" \
			--expression "s/{{color9}}/$color9/g" \
			--expression "s/{{color10}}/$color10/g" \
			--expression "s/{{color11}}/$color11/g" \
			--expression "s/{{color12}}/$color12/g" \
			--expression "s/{{color13}}/$color13/g" \
			--expression "s/{{color14}}/$color14/g" \
			--expression "s/{{color15}}/$color15/g" \
			--expression "s/{{font_size}}/10/g" \
			--expression "s/{{primary_monitor}}/${MONITOR1}/g" \
			--expression "s/{{primary_monitor_width}}/${MONITOR1_W}/g" \
			--expression "s/{{primary_monitor_height}}/${MONITOR1_H}/g" \
			--expression "s/{{primary_monitor_position}}/${MONITOR1_POS}/g" \
			--expression "s/{{secondary_monitor}}/${MONITOR2}/g" \
			--expression "s/{{secondary_monitor_width}}/${MONITOR2_W}/g" \
			--expression "s/{{secondary_monitor_height}}/${MONITOR2_H}/g" \
			--expression "s/{{secondary_monitor_position}}/${MONITOR2_POS}/g" \
			--expression "s/{{cursor_theme}}/${CURSOR_THEME}/g" \
			--expression "s|{{wallpaper}}|${WALLPAPER}|g" \
			"$template" > "$file" || continue
		echo "Generated file from template: $file"
	done
done
